:- dynamic here/1.
:- dynamic have/1.
:- dynamic door/2.
:- dynamic locked_door/2.
:- dynamic location/2.
:- dynamic character/2.
:- dynamic clue/2.
:- dynamic clue_found/1.
:- dynamic talked/1.
:- dynamic choice_made/1.
:- dynamic key_item/2.
:- dynamic event_triggered/1.
:- dynamic investigation_started/1.
:- dynamic luger_available/1.
:- dynamic hinkle_found/1. 
:- dynamic case_in_safe/0.         
:- dynamic safe_open/0.

member(X, [X|_]).
member(X, [_|T]) :- member(X, T). 

/*Игровые сокращения для перемещения*/
'Холл' :- goto('Холл').
'Каминная' :- goto('Каминная').
'Контора' :- goto('Контора').
'Столовая' :- goto('Столовая').
'Бильярдная' :- goto('Бильярдная').
'Коридор_2_этаж' :- goto('Коридор 2 этаж').
'Номер_Глебски' :- goto('Номер Глебски (4)').
'Номер_Олафа' :- goto('Номер Олафа').
'Номер_Брюн' :- goto('Номер Брюн').
'Номер_Хинкуса' :- goto('Номер Хинкуса').
'Номер_Мозесов_1' :- goto('Номер Мозесов (1)').
'Номер_Мозесов_2' :- goto('Номер Мозесов (2)').
'Номер_Симонэ' :- goto('Номер Симонэ').
'Номер_дю_Барнстокра' :- goto('Номер дю Барнстокра').
'Номер_музей' :- goto('Номер-музей (Погибшего Альпиниста)').
'Крыша' :- goto('Крыша').
'Подвал' :- goto('Подвал').
'Гостевая' :- goto('Гостевая (первый этаж)').
'Кухня' :- goto('Кухня').
'Коридор_к_номерам_Мозесов' :- goto('Коридор к номерам Мозесов').

/*Начало игры*/
here('Холл').
старт :- 
    init_game,
    welcome, 
    nl, 
    look.

init_game :-
    retractall(event_triggered(_)),
    retractall(investigation_started(_)),
    retractall(clue_found(_)),
    retractall(talked(_)),
    retractall(have(_)),
    retractall(hinkle_found(_)),
    retractall(luger_available(_)), 
    asserta(luger_available(false)), % Изначально Люгер недоступен
    asserta(character('Алек Сневар', 'Холл')),
    asserta(character('Кайса', 'Кухня')),
    asserta(character('Хинкус', 'Крыша')),
    asserta(character('Мозес', 'Номер Мозесов (2)')),
    asserta(character('Госпожа Мозес', 'Номер Мозесов (2)')),
    asserta(character('Симонэ', 'Номер Симонэ')),
    asserta(character('дю Барнстокр', 'Номер дю Барнстокра')),
    asserta(character('Брюн', 'Номер Брюн')),
    asserta(character('Луарвик Л. Луарвик', 'Гостевая (первый этаж)')).

welcome :-
    ansi_format([fg(red)],"ОТЕЛЬ 'У ПОГИБШЕГО АЛЬПИНИСТА'", []), nl,nl,
    ansi_format([fg(cyan)],  "Текстовая игра по мотивам повести Аркадия и Бориса Стругацких.", []), nl,nl,
    ansi_format([fg(blue)], "Вы - Петер Глебски, инспектор полиции в отпуске. Приехали в удаленный горный отель на две недели отдыха.", []),
    nl,
    ansi_format([fg(blue)], "Но отдых не задался: вечером в отель явился странный однорукий незнакомец, предствавившийся Луарвиком, он ищет Олафа.", []),
    nl,
    ansi_format([fg(blue)], "Хозяин передал гостя Кайсе, а вы отправились вместе со Сневаром к номеру Олафа, но столкнулись с непредвиденными обстоятельствами...", []),
    nl,
    ansi_format([fg(blue)], "Теперь вы должны расследовать убийство и раскрыть тайны отеля.", []),
    nl, nl,
    write("Команды:"), nl,
    write("  старт.           --> Начать расследование"), nl,
    write("  справка.               - Показать этот список команд"), nl,
    write("  инвентарь.       --> Проверить инвентарь"), nl,
    write("  осмотреться.     --> Осмотреться вокруг"), nl,
    write("  взять('предмет'). --> Взять предмет"), nl,
    write("  осмотреть('предмет'). --> Осмотреть предмет внимательно"), nl,
    write("  использовать('предмет'). --> Использовать предмет"), nl,
    write("  поговорить('персонаж'). --> Поговорить с персонажем"), nl,
    write("  допрос('персонаж'). --> Начать официальный допрос"), nl,
    write("  остановить.      --> Выйти из игры"), nl,
    nl, nl, !.

справка :-
    ansi_format([bold, fg(green)], "ОСНОВНЫЕ КОМАНДЫ:", []), nl,
    write("  справка.               - Показать этот список команд"), nl,
    write("  старт.                 - Начать игру (только в начале)"), nl,
    write("  осмотреться.           - Осмотреться вокруг"), nl,
    write("  инвентарь.             - Проверить содержимое инвентаря"), nl,
    write("  остановить.            - Прекращение игры"), nl, nl,
    
    ansi_format([bold, fg(green)], "ПЕРЕМЕЩЕНИЕ:", []), nl,
    write("  идти('Локация').       - Перейти в указанную локацию"), nl,
    write("  или сокращения:        'Холл', 'Каминная', 'Контора' и т.д."), nl,
    write("  (просто введите название локации без кавычек)"), nl, nl,
    
    ansi_format([bold, fg(green)], "ВЗАИМОДЕЙСТВИЕ С ПРЕДМЕТАМИ:", []), nl,
    write("  взять('Предмет').      - Взять предмет"), nl,
    write("  осмотреть('Предмет').  - Осмотреть предмет внимательно"), nl,
    write("  использовать('Предмет'). - Использовать предмет"), nl,
    write("  открыть('Дверь').      - Открыть запертую дверь (нужны ключи)"), nl, nl,
    
    ansi_format([bold, fg(green)], "ОБЩЕНИЕ И РАССЛЕДОВАНИЕ:", []), nl,
    write("  поговорить('Персонаж'). - Поговорить с персонажем"), nl,
    write("  допрос('Персонаж').    - Начать официальный допрос"), nl,
    write("  показать_улики.    - Посмотреть заметки Глебски касательно дела"), nl,
    write("  расследовать.          - Проанализировать собранные улики"), nl.  

/*Локации отеля*/
room('Холл').
room('Каминная').
room('Контора').
room('Столовая').
room('Бильярдная').
room('Коридор 2 этаж').
room('Номер Глебски (4)').
room('Номер Олафа').
room('Номер Хинкуса').
room('Номер Мозесов (1)').  
room('Номер Мозесов (2)').
room('Номер Симонэ').
room('Номер дю Барнстокра').
room('Номер Брюн').
room('Номер-музей (Погибшего Альпиниста)').
room('Крыша').
room('Подвал').
room('Кухня').
room('Гостевая (первый этаж)').
room('Коридор к номерам Мозесов').
room('Гостевая комната (первый этаж)').


description('Холл', 'Входная зона отеля. Здесь ощущеается теплый запах камина и старого дерева, а низкие столики тускло отсвечивают лаком. Хозяин Алекс Сневар обычно сидит за столиком с бумагами. Впереди лестница ведёт на второй этаж. Сбоку дверь в Каминную открыта.').
description('Каминная', 'Уютная комната с горящим камином. Кресла, книжные полки. Здесь хозяин ведёт свои философские беседы о двигателях первого и второго рода. Можно вернуться в Холл.').
description('Контора', 'Кабинет Алекса Сневара. Стол, уютное госетвое кресло, учётные книги, сейф. На столе лежат ключи от номеров. Можно покинуть Контору.').
description('Столовая', 'Большая комната на втором этаже. Огромный стол персон на двадцать, пять окон. Здесь проходил вчерашний ужин. Выходы: в Бильярдную и в Коридор 2 этаж.').
description('Бильярдная', 'Комната с бильярдным столом. Здесь Симонэ, отпуская вальяжные шутки, обыгрывал всех. Можно вернуться в Столовую.').
description('Коридор 2 этаж', 'Длинный коридор с номерами гостей. Двери: Номер Олафа, Номер Хинкуса, Номер Симонэ, Номер дю Барнстокра, Номер Брюн, ваш Номер (4), Номер-музей. Лестница ведёт на Крышу и вниз в Холл.').
description('Номер Глебски (4)', 'Ваш номер. Чисто, аккуратно, вид на долину. На столе лежат ваши заметки и какая-то записка. Можно выйти в Коридор 2 этажа.').
description('Номер Олафа', 'Комната, где найден труп Олафа Андварафорса. Дверь опечатана, но у вас есть ключ. Странный аптечный запах. Окно открыто. Можно осмотреть комнату.').
description('Номер Хинкуса', 'Комната Хинкуса. Беспорядок, запах лекарств. На столе бутылка бренди. Нужно обыскать (осмотреть) баул.').
description('Номер Мозесов (1)', 'Роскошный номер. Принадлежит Мозес. Всё до щипетильности аккуратно. Большой кованый сундук стоит в углу.').
description('Номер Мозесов (2)', 'Второй номер госпожи Мозес. Изящно обставлен, пахнет духами.').
description('Номер Симонэ', 'Комната физика. Книги, расчёты на бумаге. На столе лежит разобранный радиоприёмник.').
description('Номер дю Барнстокра', 'Номер известного фокусника. Всё изящно, на столе карточные колоды и бумаги. Чувствуется запах дорогих сигар.').
description('Номер Брюн', 'Номер чада дю Барнстокра. Разоренная кровать, у изголовья початая бутылка, на столе и кровати незаконченные плакаты.').
description('Номер-музей (Погибшего Альпиниста)', 'Здесь хранятся вещи погибшего альпиниста: куртка, альпеншток, трубка. Трубка почему-то дымится.На столе лежит свежая газета.').
description('Крыша', 'Плоская крыша отеля, покрытая снегом. Шезлонги, павильон. Отсюда видна вся долина. Здесь сидел Хинкус. Лестница ведёт в Коридор 2 этажа.').
description('Подвал', 'Служебное помещение. Сыро, темно. Стеллажи с припасами. Здесь можно спрятаться или спрятать...').
description('Кухня', 'Кухня отеля, где работает Кайса. Чисто, пахнет едой. Дверь в Холл.').
description('Гостевая (первый этаж)', 'Номер, где лежит однорукий незнакомец, представившийся как Луарвик Л. Луарвик. Он только что пришёл в себя после обвала.').
description('Коридор к номерам Мозесов', 'Узкий коридор на первом этаже, ведущий к номерам супругов Мозес.').
description('Гостевая комната (первый этаж)', 'Небольшой номер на первом этаже. В данный момент пустует.').

/*Предметы и их расположение*/
location('Связка ключей', 'Контора').
location('Ключ от сейфа', 'Каминная').
location('Заметки Глебски', 'Номер Глебски (4)').
location('Пистолет Люгер', 'Номер Хинкуса'). 
location('Бутылка бренди', 'Номер Хинкуса').
location('Баул Хинкуса', 'Номер Хинкуса').
location('Чемодан Олафа', 'Номер Олафа').
location('Тело Олафа', 'Номер Олафа').
location('Записка', 'Номер дю Барнстокра').  %Записка от Филина
location('Кованый сундук', 'Номер Мозесов (1)').
location('Трубка Альпиниста', 'Номер-музей (Погибшего Альпиниста)').
location('Свежая газета', 'Номер-музей (Погибшего Альпиниста)').
location('Радиоприёмник', 'Номер Симонэ').
location('Деньги (80 000 крон)', 'Гостевая (первый этаж)').  % У Луарвика
location('Початая бутылка виски', 'Номер Брюн').
location('Ожерелье Кайсы', 'Номер Олафа').  % Найдено в руке Олафа
location('Фирменная настойка', 'Холл').       % Для медитации
location('Сигареты', 'Номер Глебски (4)').   % Личные вещи Глебски
location('Записка о Филине', 'Номер Глебски (4)'). % Анонимное предупреждение


/*CLUES - улики, которые нельзя взять, но можно обнаружить*/
clue('Часовая стрелка часов Хинкуса сломана', 'Номер-музей (Погибшего Альпиниста)').
clue('Синяки на шее Хинкуса', 'Номер-музей (Погибшего Альпиниста)').
clue('Химический запах изо рта Олафа', 'Номер Олафа').
clue('Открытое окно в комнате Олафа', 'Номер Олафа').
clue('Снежное чучело Хинкуса на крыше', 'Крыша').
clue('Пропавшие золотые часы', 'Номер Хинкуса').

/*Двери и соединения*/
door('Холл', 'Каминная').
door('Холл', 'Контора').
door('Холл', 'Кухня').
door('Холл', 'Коридор к номерам Мозесов').  

door('Коридор к номерам Мозесов', 'Номер Мозесов (1)').
door('Коридор к номерам Мозесов', 'Номер Мозесов (2)').
door('Коридор к номерам Мозесов', 'Гостевая комната (первый этаж)').
door('Холл', 'Коридор 2 этаж').  % Лестница

door('Коридор 2 этаж', 'Столовая').
door('Коридор 2 этаж', 'Номер Глебски (4)').
door('Коридор 2 этаж', 'Номер Олафа').
door('Коридор 2 этаж', 'Номер Хинкуса').
door('Коридор 2 этаж', 'Номер Симонэ').
door('Коридор 2 этаж', 'Номер Брюн').
door('Коридор 2 этаж', 'Номер дю Барнстокра').
door('Коридор 2 этаж', 'Номер-музей (Погибшего Альпиниста)').
door('Коридор 2 этаж', 'Крыша').
door('Столовая', 'Бильярдная').

locked_door('Номер Олафа', 'Коридор 2 этаж').  % Сначала закрыт
locked_door('Номер Мозесов (2)', 'Коридор к номерам Мозесов'). % Госпожа Мозес не пускает

/*Предметы для открытия*/
key_item('Связка ключей', 'Номер Олафа').
key_item('Связка ключей', 'Номер Мозесов (2)'). % От всех номеров
key_item('Ключ от сейфа', 'Контора').  % Для чемодана
key_item('Ключ от сундука', 'Номер Мозесов (1)'). % Находится у Мозеса

/*Правила соединения*/
connect(X, Y) :- door(X, Y).
connect(X, Y) :- door(Y, X).


connect(X, Y) :- locked_door(X, Y).
connect(X, Y) :- locked_door(Y, X).

/*Осмотр локации*/
look :-
    here(Place),
    write('Вы находитесь: '),
    ansi_format([bold, fg(cyan)], Place, []),
    nl,
    description(Place, Y),
    ansi_format([fg(cyan)], Y, []), nl, nl,
    
    write('Предметы в комнате:'), nl,
    list_things(Place),

    write('Персонажи здесь:'), nl,
    list_characters(Place),
    
    ( has_clues(Place) ->
        write('Заметки для расследования:'), nl,
        list_clues(Place)
    ; true ),
    
    write('Куда можно пойти:'), nl,
    list_connections(Place).


/*Список предметов в комнате*/
list_things(Place) :-
    location(X, Place),
    tab(4),
    ansi_format([bold, fg(blue)], X, []),
    nl,
    fail.
list_things(_).

/*Список персонажей в комнате*/
list_characters(Place) :-
    character(X, Place),
    tab(4),
    ansi_format([bold, fg(yellow)], X, []),
    nl,
    fail.
list_characters(_).

/*Список улик в комнате*/
list_clues(Place) :-
    clue(X, Place),
    \+ clue_found(X),
    tab(4),
    ansi_format([bold, fg(yellow)], "Улика: ", []),
    write(X), nl,
    fail.
list_clues(_).

has_clues(Place) :-
    clue(Clue, Place),
    \+ clue_found(Clue),
    !.

показать_улики :-
    (   clue_found(_) ->  write('Заметки для расследования:'), nl,
        show_clues;
        write('Заметки для расследования: пока нет.'), nl
    ).

show_clues :-
    clue_found(Clue),
    tab(4),
    ansi_format([fg(yellow)], '• ~w', [Clue]),
    nl,
    fail.
show_clues.

/*Список мест, куда можно пойти из этой комнаты*/
list_connections(Place) :-
    connect(Place, X),
    tab(4),
    ansi_format([bold, fg(green)], X, []),
    nl, fail.
list_connections(_).

/*Инвентарь*/
инвентарь :-
    write('Ваш инвентарь:'), nl,
    (have(X),
    tab(4),
    ansi_format([fg(blue)], X, []),
    nl,
    fail);
    (\+ have(_), write('  (пусто)'), nl).

/*Перемещение*/
goto(Place) :-
    can_go(Place),
    check_special_events(Place),
    move(Place),
    look.

can_go(Place) :-
    here(X),
    connect(X, Place),
    \+ (locked_door(X, Place); locked_door(Place, X)), !.
can_go(Place) :-
    here(Place),
    write('Вы уже здесь.'), nl, !, fail.
can_go(Place) :-
    room(Place), !,
    write('Нельзя попасть отсюда.'), nl, fail.
can_go(_) :-
    write('Такого места нет или опечатка.'), nl, fail.

move(Place) :-
    retract(here(_)),
    asserta(here(Place)).

open_door(Place) :-
    here(Current),
    (   locked_door(Place, Current);
        locked_door(Current, Place)
    ),
    have('Связка ключей'),
    retractall(locked_door(Place, Current)),
    retractall(locked_door(Current, Place)),
    write('Вы открыли дверь.'), nl,
    !.

open_door(_) :-
    write('Эту дверь нельзя открыть или у вас нет ключей.'), nl,
    fail.

/*Сюжетные события*/
check_special_events(Place) :-
    here(Current),
    special_event(Current, Place).

special_event('Коридор 2 этаж', 'Номер Олафа') :-
    \+ event_triggered('Убийство обнаружено'),
    nl,
    ansi_format([bold, fg(red)], "ВНИМАНИЕ: СЦЕНА УБИЙСТВА!", []),
    nl,
    write('Вы входите в номер Олафа. В комнате холодно.'), nl,
    write('На полу лежит тело Олафа Андварафорса. Его шея вывернута под неестественным углом. Необходимо осмотреть тело'), nl,
    write('В руке он сжимает ожерелье Кайсы.'), nl,
    asserta(event_triggered('Убийство обнаружено')),
    asserta(investigation_started(true)),
    retract(character('Хинкус', 'Крыша')),  % Убираем с крыши
    asserta(character('Хинкус', 'Номер-музей (Погибшего Альпиниста)')),
    % Пистолет перемещается на крышу
    retract(location('Пистолет Люгер', 'Номер Хинкуса')),
    asserta(location('Пистолет Люгер', 'Крыша')),
    asserta(luger_available(true)),  % Теперь доступен
    !.

special_event('Коридор 2 этаж', 'Номер-музей (Погибшего Альпиниста)') :-
    investigation_started(true),
    \+ hinkle_found(true),
    nl,
    ansi_format([bold, fg(green)], "Хинкус найден!", []),
    nl,
    write('Под столом вы находите связанного Хинкуса с кляпом во рту.'), nl,
    write('Он в ужасе, на шее у него синяки.'), nl,
    write('Вы освобождаете его. Хинкуса бьет дрожь, он ничего не может внятно объяснить.'), nl,
    write('Он молчит, трясясь от страха.'), nl, nl,
    
    write('Вы помогаете Хинкусу освободиться от веревок.'), nl,
    write('Странно, сегодня он весь день провел на крыше.'), nl,
    write('Стрелка на его часах застыла, показывая время нападения. В этот момент все были в столовой на празднике,'), nl,
    write('но некоторые люди все же выходили. Например, Брюн и Олаф.'), nl,
    write('Хинкус благодарно кивает и пытается прийти в себя, всё еще потрясенный случившимся.'), nl,
    write('Он уходит в каминную за успокоительным бренди. У вас есть отличный шанс заглянуть в его номер и обыскать вещи.'), nl,

    asserta(hinkle_found(true)),
    asserta(event_triggered('Хинкус найден')),
    asserta(clue_found('Часовая стрелка часов Хинкуса сломана')),
    asserta(clue_found('Синяки на шее Хинкуса')),
    retract(character('Хинкус', 'Номер-музей (Погибшего Альпиниста)')),
    asserta(character('Хинкус', 'Каминная')),  
    !.

special_event('Коридор 2 этаж', 'Крыша') :-
    hinkle_found(true),
    nl,
    ansi_format([bold, fg(blue)], "Осмотр крыши", []),
    nl,
    write('Теперь, зная о произошедшем с Хинкусом, вы осматриваете крышу внимательнее.'), nl,
    write('На шезлонге все еще лежит Хинкус, но как? Подойдя поближе, вы замечаете, что это просто снежное чучело.'), nl,
    write('Под одним из шезлонгов вы находите пистолет Люгер с серебряными пулями!'), nl,
    write('Люгер калибра 0.45 с удлиненной рукоятью. Вот это было настоящее гангстерское оружие.'), nl,
    write('Похоже, Хинкус держал его при себе на до нападения, но зачем?..'), nl,
    asserta(clue_found('Снежное чучело Хинкуса на крыше')),
    !.

special_event(_, _).

/*Взаимодействие с предметами*/
взять(X) :-
    can_take(X), !,
    take_object(X).

can_take(Thing) :-
    here(Place),
    is_available(Thing),
    location(Thing, Place), !.
can_take(Thing) :-
    write('Здесь нет '), write(Thing), write('.'), nl, fail.


take_object('Пистолет Люгер') :-
    here('Крыша'),
    luger_available(true),
    retract(luger_available(true)),
    retract(location('Пистолет Люгер', 'Крыша')),
    asserta(have('Пистолет Люгер')),
    write('Вы взяли: Пистолет Люгер'), nl,
    !.

take_object('Заметки Глебски') :-
    here('Номер Глебски (4)'),
    retract(location('Заметки Глебски', 'Номер Глебски (4)')),
    asserta(have('Заметки Глебски')),
    write('Вы взяли заметки. Теперь в них можно проверить все найденные улики.'), nl,
    write('Введите "показать_улики.", чтобы увидеть уже собранные улики.'), nl,
    !.

take_object(Thing) :-
    here(Place),
    retract(location(Thing, Place)),
    asserta(have(Thing)),
    write('Вы взяли: '), write(Thing), nl,
    special_effect(Thing).

is_available(Thing) :-
    (   have(Thing)
    ;   location(Thing, _) % Если уже взяли, то доступен для просмотра в инвентаре
    ),
    (   member(Thing, ['Пистолет Люгер']) ->  luger_available(true)  
    ;   true                    % Все остальные доступны по умолчанию
    ).


положить(Thing) :-
    have(Thing),
    here(Место),
    write('Вы положили '), write(Thing), write(' обратно в '), write(Место), nl,
    retract(have(Thing)),
    asserta(location(Thing, Место)),
    !.

положить(Thing) :-
    \+ have(Thing),
    write('У вас нет предмета '), write(Thing), nl.

special_effect('Связка ключей') :-
    write('Теперь вы можете открывать запертые двери!'), nl.
special_effect('Записка') :-
    nl, write('Содержание записки:'), nl,
    write('"Мы вас нашли. Я держу вас на мушке. Не пытайтесь бежать не делайте глупостей.'), nl,
    write('Стрелять буду без предупреждения. Ф."'), nl.
special_effect('Пистолет Люгер') :-
    write('Пистолет заряжен серебряными пулями, чистое серебро! Странно...'), nl.
special_effect('Чемодан Олафа') :-
    write('Чемодан тяжёлый. Внутри странный прибор, похожий на техническое устройство.'), nl.
special_effect('Записка о Филине') :-
    nl,
    ansi_format([bold, fg(red)], "СОДЕРЖАНИЕ ЗАПИСКИ:", []), nl,
    write('"Инспектору Глебски. В отеле под именем Хинкус скрывается'), nl,
    write('опасный гангстер, маньяк и садист Филин. Он вооружен и угрожает одному из'), nl,
    write('постояльцев. Примите срочные меры."'), nl, nl,
    write('Записка анонимная, написана отпечатанными буквами.'), nl,
    write('Теперь вы знаете о настоящей личности Хинкуса или о том, что его кто-то хочет подставить.'), nl,
    asserta(event_triggered('Записка_прочитана')),
    
    % Если находимся в номере Глебски, слышим звуки из соседней комнаты
    here('Номер Глебски (4)'),
    nl,
    ansi_format([bold, fg(yellow)], "ВНИМАНИЕ!", []), nl,
    write('Из соседнего номера-музея доносятся странные звуки:'), nl,
    write('  - Приглушенные стоны'), nl,
    write('  - Как будто кто-то стучит'), nl,
    write('Кто-то явно там есть!'), nl,
    write('Стоит проверить номер-музей.'), nl.

special_effect(_).

открыть(Door) :-
    here(Here),
    (locked_door(Door, Here); locked_door(Here, Door)),
    have('Связка ключей'),
    retractall(locked_door(Door, Here)),
    retractall(locked_door(Here, Door)),
    asserta(door(Door, Here)),
    asserta(door(Here, Door)),
    write('Вы открыли дверь в '), write(Door), write('.'), nl.
открыть(_) :-
    write('Не могу открыть или нет ключей.'), nl.

осмотреть('Баул Хинкуса') :-
    here('Номер Хинкуса'),
    write('Вы открываете баул Хинкуса и находите:'), nl,
    write('1. Фальшивый багаж - тряпье и случайные книги'), nl,
    write('2. Во втором бауле: золотые часы Мозеса и дамский браунинг'), nl,
    asserta(clue_found('Пропавшие золотые часы')),
    !.

осмотреть('Ожерелье Кайсы') :-
    have('Ожерелье Кайсы'),
    write('Деревянные бусы Кайсы. Найдены в руке убитого Олафа.'), nl,
    write('Возможно, убийца хотел подставить Кайсу.'), nl.

осмотреть('Тело Олафа') :-
    (   clue_found('Химический запах изо рта Олафа') ->  true
    ;   write('Вы чувствуете странный химический запах.'), nl,
        asserta(clue_found('Химический запах изо рта Олафа'))
    ),

    (   clue_found('Открытое окно в комнате Олафа') ->  true
    ;   write('Вы поднимаете голову и видите, что окно в комнате широко распахнуто.'), nl,
        write('Надо зайти в свой номер и взять заметки для записи улик.'), nl,
        asserta(clue_found('Открытое окно в комнате Олафа'))
    ).

осмотреть(_) :-
    write('Нечего особого осматривать.'), nl.

использовать('Связка ключей') :-
    have('Связка ключей'), nl,
    open_door(_),
    !.

использовать('Ключ от сейфа') :-
    have('Ключ от сейфа'),
    here('Контора'),
    \+ safe_open,
    asserta(safe_open),
    write('Вы открыли сейф.'), nl.

использовать('Фирменная настойка') :-
    have('Фирменная настойка'),
    write('Вы выпили настойку. Крепко! Но теперь ясно мыслите.'), nl,
    retract(have('Фирменная настойка')).

использовать('Сигареты') :-
    have('Сигареты'),
    write('Вы закурили. Помогает сосредоточиться.'), nl.

использовать('Чемодан Олафа') :-
    have('Чемодан Олафа'),
    write('Вы открываете чемодан. Внутри сложный прибор с непонятным назначением.'), nl,
    (   talked('Мозес_допрос')
    ->  write('Луарвик Л. Луарвик предлагает 80 000 крон за этот чемодан.'), nl
    ;   true
    ).

использовать('Пистолет Люгер') :-
    have('Пистолет Люгер'),
    write('Пистолет заряжен серебряными пулями. Хинкус утверждает, что они нужны против оборотней.'), nl.

использовать('Сейф') :-
    here('Контора'),
    safe_open,
    have('Чемодан Олафа'),
    retract(have('Чемодан Олафа')),
    asserta(case_in_safe),
    write('Вы кладёте чемодан в сейф.'), nl.

использовать('Сейф') :-
    here('Контора'),
    safe_open,
    case_in_safe,
    retract(safe_open),
    write('Сейф надежно закрывается. Теперь чемодан в безопасности.'), nl.

использовать('Сейф') :-
    here('Контора'),
    \+ have('Чемодан Олафа'),
    case_in_safe,
    write('Сейф заперт. Чемодан Олафа находится внутри.'), nl.

использовать(_) :-
    write('Нельзя использовать этот предмет здесь.'), nl.


/*Диалоги с персонажами*/
поговорить(Персонаж) :-
    here(Место),
    character(Персонаж, Место), !,
    диалог(Персонаж, 1).

поговорить(_) :-
    write('Здесь нет такого персонажа.'), nl.

диалог('Алекс Сневар', 1) :-
    write('Алекс Сневар (хозяин отеля): "А, Петер! Странные дела творятся в моем отеле. Трубка курит сама,'), nl,
    write('вещи пропадают, а теперь это... это убийство. Я всегда чувствовал,'), nl,
    write('что дух Погибшего Альпиниста не покинул эти стены."'), nl.

диалог('Хинкус', 1) :-
    write('Хинкус (дрожит): "Он... он пришел сзади. Я видел его раньше, днем.'), nl,
    write('Но говорить не буду! Не заставьте меня! Лучше убейте сразу, а еще лучше налейте бренди!"'), nl,
    write('На шее у Хинкуса свежие синяки.'), nl.

диалог('Мозес', 1) :-
    write('Вы входите в номер. Оба Мозеса стоят вместе - он мрачный и замкнутый, она...'), nl,
    write('госпожа Мозес выглядит совершенно нормально. Никаких признаков... ну, того, о чём говорил Симонэ.'), nl, nl,
    write('Глебски (резко): "Госпожа Мозес. Мне сказали, что вы... что с вами случилось что-то."'), nl,
    write('госпожа Мозес (удивлённо поднимая брови): "Со мной? О, инспектор, какие глупости! Я просто читала журнал в своей комнате и заснула."'), nl,
    write('Её голос спокоен, почти мелодичен. Ни тени волнения.'), nl, nl,
    write('Глебски: "Вы ничего не слышали? Не видели? Кто-то входил к вам?"'), nl,
    write('госпожа Мозес (лёгким жестом): "Я спала очень крепко. После ужина... вы знаете, горный воздух."'), nl,
    write('Мозес (хрипло вмешивается): "Видите, инспектор? Всё в порядке."'), nl,
    write('Глебски чувствует, что ему лгут. Но как? И зачем?'), nl,
    write('"Почему тогда ваша дверь была заперта изнутри?" - не сдаётся он.'), nl,
    write('госпожа Мозес (пожимая плечами): "Я всегда запираюсь на ночь. Привычка."'), nl,
    nl,
    write('Диалог заканчивается. Они стоят рядом - странная, идеально невозмутимая пара.'), nl,
    write('Что-то здесь не так. Что-то фундаментально не так.'), nl.

диалог('Симонэ', 1) :-
    write('Симонэ (схватив Глебски за рукав, взволнованно): "Петер! Я должен тебе сказать. Я видел... я видел её!"'), nl,
    nl,
    write('Глебски: "Кого?"'), nl,
    write('Симонэ (понизив голос до шёпота): "Госпожу Мозес. Она... она лежит в своём номере. Холодная. Без движения."'), nl,
    nl,
    write('Глебски (недоверчиво): "Ты что, пьян?"'), nl,
    write('Симонэ (трясёт головой, глаза горят): "Я трезв как судья! Я принял твёрдое решение. Весь вечер готовился."'), nl,
    write('"В одиннадцать пошёл к ней в номер - поговорить, узнать что-нибудь. А она..."'), nl,
    write('Симонэ (собираясь с духом): "Дверь была приоткрыта. Я заглянул. Она лежала на кровати, одетая."'), nl,
    write('"Я позвал - не ответила. Подошёл ближе... Петер, она была холодная. Совсем."'), nl,
    write('Глебски: "И что ты сделал?"'), nl,
    write('Симонэ (растерянно): "Я... я испугался. Закрыл дверь и ушёл. Но потом подумал..."'), nl,
    write('Симонэ (умоляюще): "Проверь! Сходи в её номер! Дверь заперта, но у тебя же ключи!"'), nl,
    write('Глебски вздыхает. "Хорошо, проверю."'), nl.

диалог('Луарвик Л. Луарвик', 1) :-
    write('Луарвик Л. Луарвик (косоглазый, однорукий): "Я имею дело с Олафом Андварафорс. Он должен вернуть то, что взял. Комендант двести двадцать четыре."'), nl,
    write('Он говорит монотонно, как запрограммированный.'), nl.

диалог('Брюн', 1) :-
    \+ talked('Брюн_допрос'),
    write('Брюн (не снимая черных очков, угрюмо): "Что вам еще нужно? Оставьте меня в покое. Брюн уходит к дяде.'), nl,
    asserta(talked('Брюн_ушла_к_дяде')),
    retract(character('Брюн', _)),
    asserta(character('Брюн', 'Номер дю Барнстокра')).

диалог('дю Барнстокр', 1) :-
    talked('Брюн_допрос'),
    write('дю Барнстокр (сокрушенно): "Дорогой инспектор! Я, конечно, понятия не имел... Дети растут. Ужасно растут."'), nl, !.

диалог('дю Барнстокр', 1) :-
    write('дю Барнстокр (вяло): "А? О чем речь? Брюн? Она отдыхает. Не тревожьте её, прошу вас."'), nl.

диалог('Кайса', 1) :-
    write('Кайса (краснея): "Ой, господин инспектор! Я ничего не знаю!'), nl,
    write('Только вот ожерелье мое пропало, и кто-то в моей постели валялся...'), nl,
    write('И следы мокрые в коридоре видела..."'), nl.
диалог(_, 1) :-
    write('Персонаж что-то бормочет, но вы не можете разобрать слов.'), nl.

/*Допросы*/
допрос(Персонаж) :-
    here(Место),
    character(Персонаж, Место), !,
    допрос_сцена(Персонаж).

допрос(_) :-
    write('Некого допрашивать здесь.'), nl.

допрос_сцена('Хинкус') :-
    have('Пистолет Люгер'),
    \+ talked('Хинкус_признание'),
    nl,
    ansi_format([bold, fg(red)], '=== ДОПРОС ХИНКУСА ===', []), nl,
    write('Вы достаёте пистолет Люгер и кладёте его на стол перед Хинкусом.'), nl,
    write('Глебски:Х ватит врать, Филин! Мне все о тебе известно! Ты влип, Филин.'), nl,
    write('В отеле убили Олафа, Филин, а из гангстеров и без алиби ты здесь один.'), nl,
    write('И если ты хочешь отделаться семьдесят второй, тяни на пункт «ц»! Чистосердечное признание до начала официального следствия… Ну?'), nl,
    write('Хинкус (угрюмо): Филин какой-то. Я не Филин, я — Хинкус. Чего вы ко мне привязались?'), nl,
    write('После угроз он кидается на вас, завязывается драка.'), nl,
    write('Вам удается сбить его с ног, он грузно падает и тяжело дышит.'), nl,
    write('У вас кружится голова от ночи без сна, шатаются два зуба от тяжелой руки гангстера.'), nl,
    write('Через какое-то время, прийдя в себя, вы слышите:'), nl,
    write('"Я понял, что вам надо, господин инспектор. Я — Филин. Наёмник банды Чемпиона.'), nl,
    write('Мы использовали Вельзевула для ограблений, а потом он сбежал. Я должен был его ликвидировать.'), nl,
    write('Я выследил его, он в этом отеле. Его лица я не видел, но это точно один из постояльцев.'), nl,
    write('Он оборотень, колдун! Серебряные пули — единственное, что может его остановить!'), nl,
    write('Он всегда действовал с напарницей, а Олафа я увидел вчера впервые, он никогда и не был моей целью."'), nl,
    write('Он явно напуган.'), nl,
    asserta(talked('Хинкус_признание')),
    !.

допрос_сцена('Хинкус') :-
    \+ have('Пистолет Люгер'),
    nl,
    write('Вы пытаетесь допросить Хинкуса, но он лишь бормочет что-то невнятное.'), nl,
    write('Хинкус (дрожа): "Не знаю я ничего... Отстаньте..."'), nl,
    write('Он явно напуган, но у вас нет доказательств, чтобы прижать доброго гражданина.'), nl,
    write('Возможно, нужны веские доказательства...'), nl,
    !.

допрос_сцена('Мозес') :-
    \+ talked('Мозес_допрос'),  % Чтобы допрос был однократным
    nl,
    ansi_format([bold, fg(yellow)], '=== ДОПРОС ГОСПОДИНА МОЗЕСА ===', []), nl,
    write('Мозес (хрипло, после долгого молчания): "Всё сложнее, чем вы думаете, инспектор..."'), nl, nl,
    
    write('Глебски: "Бросьте эти сказки. Что вы знаете об убийстве?"'), nl,
    write('Мозес (отхлебывая из своей кружки): "Олаф не убит. Он вообще не живое существо."'), nl,
    write('Он механизм. Робот. Как и госпожа Мозес. Мы наблюдатели, не с этой планеты."'), nl, nl,
    
    write('Глебски (саркастически): "Понятно. И прибыли вы с Венеры?"'), nl,
    write('Мозес (печально): "Этого я не скажу. Важно другое: Олаф - наш робот-смотритель."'), nl,
    write('Он отключился из-за аварии на станции. Чемодан содержит аккумулятор для него."'), nl, nl,
    
    write('Вы пытаетесь остаться непредубежденным, но слова льются безостановочно:'), nl,
    write('"Полтора месяца назад я попал в лапы бандитов. Меня шантажировали, заставляли грабить банки."'), nl,
    write('"Я пытался бежать, но они выпустили на мой след Филина - Хинкуса."'), nl,
    write('"Пришлось скрываться здесь, надеясь улететь до их прибытия."'), nl, nl,
    
    write('Глебски: "Хорошая сказка. А почему вы не покажетесь в своем истинном обличье?"'), nl,
    write('Мозес (качая головой): "Это скафандр, инспектор. Под ним... другая форма жизни."'), nl,
    write('"Показать себя - значит почти наверняка погибнуть в вашей атмосфере."'), nl,
    write('"Но если вы окончательно не поверите... я рискну, лишь бы спасти Луарвика."'), nl, nl,
    
    write('Он предлагает возместить все убытки - и за ограбление Второго Национального,'), nl,
    write('и за золотой броневик. Чистым золотом. Миллион крон сейчас, остальное позже.'), nl, nl,
    
    write('Глебски чувствует странное сочувствие к этому существу.'), nl,
    write('Полицейская часть его требует арестовать преступника.'), nl,
    write('Человеческая часть кричит, что перед ним - не человек в обычном смысле.'), nl, nl,
    
    write('Мозес (тихо): "Есть только две возможности, инспектор."'), nl,
    write('"Либо вы отдаете нам аккумулятор, и мы попытаемся спастись."'), nl,
    write('"Либо... Я не могу попасть живым в руки официальных лиц."'), nl,
    write('"Это мой долг перед нашими мирами. Я провалился, но я первый, не последний..."'), nl, nl,
    
    write('Вы понимаете: если это правда, то дело не просто в убийстве.'), nl,
    write('Речь идет о первом контакте. И он происходит в самый неподходящий момент.'), nl,
    asserta(talked('Мозес_допрос')),
    !.

допрос_сцена('Мозес') :-
    talked('Мозес_допрос'),
    write('Мозес молчит, уставившись в свою вечную кружку. Он сказал всё, что мог.'), nl,
    !.

допрос_сцена('Брюн') :-
    here('Номер дю Барнстокра'), % Допрос возможен только когда она у дяди
    character('Брюн', 'Номер дю Барнстокра'),
    \+ talked('Брюн_допрос'),
    nl,
    ansi_format([bold, fg(yellow)], '=== Допрос Брюн ===', []), nl,
    write('Вы резко приказываете: "Снимите очки!"'), nl,
    write('Брюн повинуется. Перед вами девушка с заплаканными, но очень красивыми глазами.'), nl, nl,
    write('После нескольких наводящих вопросов она сдаётся и рассказывает правду:'), nl, nl,
    write('"Мы были у него в номере... Мы целовались. Было весело, только холодно из-за открытого окна.'), nl,
    write('Он хотел надеть мне на шею какие-то бусы, похожие на ожерелье. И тут грянул обвал.'), nl,
    write('Он вдруг схватился за голову, будто что-то вспомнил... что-то очень важное.'), nl,
    write('Он бросился к окну, но сразу вернулся, схватил меня за плечи и вытолкнул за дверь,'), nl,
    write('грубо захлопнув дверь и повернув ключ. Я разозлилась и ушла к себе напиться."'), nl, nl,
    write('На дальнейшие расспросы она добавляет:'), nl,
    write('- Он не пил, чувствовал себя прекрасно. Странного запаха не было.'), nl,
    write('- Слышался шум из комнаты Симонэ (шаги, вода).'), nl,
    write('- Олаф передвигал кресло, чтобы заблокировать дверь, но потом отодвинул.'), nl,
    write('- Больше в комнате никого, по её мнению, не было.'), nl, nl,
    write('Это ключевые показания. Олаф явно что-то понял или услышал в момент обвала.'), nl,
    asserta(talked('Брюн_допрос')), 
    write('Внезапно в коридоре раздается беглый топот шагов. Дверь соседнего номера тихо закрывается.'), nl,
    write('Глебски: Странно, в той стороне только мой номер и номер Симонэ.'), nl,
    write('Надо сходить, проверить неугомонного физика.'), nl.

допрос_сцена(_) :-
    write('Персонаж отказывается говорить без адвоката и говорит ерунду.'), nl.


/*Конец расследования*/
расследовать :-
    investigation_started(true),
    \+ talked('Брюн_допрос'),
    !,  % Отсечение, чтобы не пробовать второе правило
    nl,
    write('Вы ещё не допросили Брюн. Расследование нельзя продолжать.'), nl,
    fail. 

расследовать :-
    investigation_started(true),
    (   here('Контора')
    ->  true
    ;   write('Переместитесь в Контору и охраняйте сейф, чтобы его не вскрыли.'), nl,
        write('Там можно еще раз все проанализировать.'), nl,
        fail
    ),
    nl,
    write('=== АНАЛИЗ УЛИК ==='), nl, nl,
    
    %Проверка улик
    findall(Clue, (clue(Clue, _), \+ clue_found(Clue)), MissingClues),
    
    (MissingClues = [] ->
        write('Все улики собраны!'), nl, nl,
        write('ВЫВОДЫ:'), nl,
        write('1. Убийца не призрак - были мокрые следы'), nl,
        write('2. Хинкус не убийца - его самого пытались убить'), nl,
        write('3. Олаф был не туристом - у него был специальный прибор'), nl,
        write('4. Убийство совершено с чудовищной силой - нужен очень сильный человек'), nl,
        write('5. Окно было открыто для отвода глаз - убийца вошел через дверь'), nl, nl,
        
        write('ПОДОЗРЕВАЕМЫЕ:'), nl,
        write('- Алекс Сневар: сильный, знает все ходы в отеле'), nl,
        write('- Однорукий незнакомец: появился в ночь убийства'), nl,
        write('- Мозес: сильный, пьяный, непредсказуемый'), nl,
        write('- Симонэ: альпинист, очень сильный физически'), nl,
        write('- Кайса: имеет мотив, если Олаф её оскорбил'), nl,
        write('- Брюн: была в номере Олафа перед убийством'), nl, nl,
        
        write('...но улики противоречат друг другу. Нет ни одного человека, который...'), nl,
        write('...Глебски садится на стул, прислонившись спиной к сейфу.'), nl, nl,
        
        ansi_format([bold, fg(blue)], 'В голове проносятся слова:', []), nl,
        write('"Алекс: Дух Погибшего Альпиниста не покинул эти стены..."'), nl,
        write('"Хинкус: Он оборотень, колдун! Вельзевул среди нас!"'), nl,
        write('"Симонэ: Это не мистика, это научная фантастика!"'), nl, nl,
        
        write('Что, если все они правы по-своему?'), nl,
        write('Что, если "мистика" Алекса и "Вельзевул" Хинкуса - это...'), nl, nl,
        
       write('Глебски садится на стул в конторе, прислонившись спиной к сейфу.'), nl,
        write('Проклятый Филин его доконал. Плечо болит, голова туманится.'), nl,
        write('Он расстилает газеты перед сейфом, придвигает конторку к двери...'), nl, nl,
        
        write('...и просыпается от настойчивого стука в дверь. На часах - начало первого.'), nl, nl,
        
        % Сцена с Симонэ 
        ansi_format([bold, fg(red)], '=== ПОЛНОЧЬ. КОНТОРА. ===', []), nl,
        write('Симонэ входит. Вид у него торжественный и деловой, но чувствуется возбуждение.'), nl,
        write('Симонэ: "Пока вы дрыхли, инспектор, я выполнил за вас всю вашу работу."'), nl, nl,
        
        write('Глебски (язвительно): "Неужели Мозес уже в наручниках?"'), nl,
        write('Симонэ (нахмурившись): "В этом нет необходимости. Мозес ни в чем не виновен."'), nl,
        write('"Здесь всё гораздо сложнее, чем вы думаете."'), nl, nl,
        
        write('Глебски: "Только не рассказывайте о вурдалаках."'), nl,
        write('Симонэ (усмехаясь): "Никаких вурдалаков. Сплошная научная фантастика."'), nl,
        write('"Мозес - не человек, инспектор. Он и Луарвик - не земляне."'), nl, nl,
        
        write('И он рассказывает. Как Мозес полтора года на Земле. Как попал в лапы бандитов.'), nl,
        write('Как Чемпион шантажом втянул его в банду. Как должна была состояться эвакуация.'), nl,
        write('Как вчера в полночь произошла авария - что-то взорвалось в аппаратуре.'), nl,
        write('Как Луарвику пришлось идти сюда пешком, через горы...'), nl, nl,
        
        write('Симонэ (умоляюще): "Петер, ты должен помочь им. Это просто наша обязанность."'), nl,
        write('"Если гангстеры поспеют сюда раньше полиции, они их убьют. Нас тоже, возможно."'), nl,
        write('"Но если мы допустим убийство инопланетников, это будет позор!"'), nl, nl,
        
        write('Глебски (сухо): "Короче, что вам от меня надо?"'), nl,
        write('Симонэ: "Отдайте им аккумулятор, Петер. В чемодане - энергия для их роботов."'), nl, nl,
        write('И тогда всё встаёт на свои места:'), nl,
        write('- "Химический запах" изо рта Олафа - охлаждающая жидкость или машинное масло'), nl,
        write('- "Чудовищная сила" при вывихе шеи - механическая сила робота'), nl,
        write('- "Свернутая шея" у госпожи Мозес - квазиагонические явления при отключении'), nl,
        write('- "Свежая газета" в музее - её менял да хоть хозяин, для мистификации'), nl, nl,
        
        write('Симонэ (настойчиво): "Это легко проверить. Отдайте аккумулятор -'), nl,
        write('и они в вашем присутствии снова включат Олафа. Ведь хотите же вы,'), nl,
        write('чтобы Олаф снова был жив?"'), nl, nl,
        
        write('Но Глебски полицейский. Он думает о законе, о долге.'), nl,
        write('О госпоже Мозес, руками которой уже совершены преступления.'), nl,
        write('О том, что даже пришельцам не должно быть позволено грабить банки. Он неприклонен.'), nl, nl,
        
        write('Симонэ (горько): "Вот тебе и первый контакт. Вот тебе и встреча двух миров."'), nl,
        write('"А вы, однако, порядочная дубина, Глебски."'), nl, nl,
        
        write('Он уходит. Глебски остаётся один перед сейфом.'), nl,
        write('Вот два факта: закон требует задержать этих людей.'), nl,
        write('И второй факт: они хотят уйти. От закона? От гангстеров? От контакта?'), nl,
        write('Эти два факта противостоят друг другу. И решение за тобой.'), nl, nl,
        
        write('Симонэ (умоляюще): "Петер, ты должен помочь им. Им нужен чемодан,'), nl,
        write('чтобы улететь. Если они останутся здесь... банда Чемпиона их найдёт и убьёт."'), nl, nl,
        
        write('Теперь у тебя есть все факты. Пора принимать решение.'), nl,
        write('Введи "закончить.", чтобы закончить расследование.'), nl,
        
        asserta(talked('все_улики_собраны'));

        write('Ещё не все улики найдены. Нужно собрать:'), nl,
        forall(member(Clue, MissingClues), (tab(4), write(Clue), nl)),
        nl
    ).

расследовать :-
    write('Расследование еще не началось. Осмотрите номер Олафа.'), nl.

/*Финальное решение*/
закончить :-
    %Проверка улик
    findall(Clue, (clue(Clue, _), \+ clue_found(Clue)), MissingClues),
    length(MissingClues, NumMissing),
    
    (NumMissing = 0 -> true  % Все улики собраны, продолжаем
    ;
        write('У вас недостаточно улик, чтобы принять решение.'), nl,
        write('Нужно собрать:'), nl,
        forall(member(Clue, MissingClues), (tab(4), write(Clue), nl)),
        nl,
        !, fail  % Отсекаем и вызываем неудачу
    ),
    write('=== ВРЕМЯ ПРИНЯТЬ РЕШЕНИЕ ==='), nl,
    write('Вы собрали все улики. Что вы сделаете?'), nl,
    write('1. Сострадание - помочь пришельцам (отдать чемодан, обеспечить побег)'), nl,
    write('2. Долг - действовать по закону (охранять сейф до приезда полиции)'), nl,
    read(Choice),
    финал(Choice).

финал(1) :-
    case_in_safe,
    talked('Мозес_допрос'),
    write('Вы решаете помочь. Отдаёте чемодан Луарвику.'), nl,
    write('Ночью пришельцы активируют Олафа. Тот встаёт и произносит: "Система восстановлена."'), nl,
    write('Вы помогаете им незаметно покинуть отель через подвал.'), nl,
    write('Наутро вы обнаруживаете, что они исчезли без следа.'), nl,
    write('Вам остаётся только составить отчёт о "неустановленных личностях, скрывшихся в горах".'), nl,
    write('=== КОНЕЦ: СОСТРАДАНИЕ ==='), nl,
    ansi_format([bold,fg(green)], 'Вы спасли не тех, кого привыкли спасать, теперь перед вами гора бумажной работы и верный друг Симонэ.', []), nl.

финал(2) :-
    case_in_safe,
    write('Вы решаете действовать строго по закону.'), nl,
    write('Вы решаете действовать строго по закону. "Никто не покинет отель до приезда полиции!"'), nl,
    write('Чемодан будет в сейфе под охраной."'), nl, nl,
    
    write('Вы спите в конторе, прислонившись спиной к сейфу. Просыпаетесь от стука.'), nl,
    write('На пороге Симонэ. "Отдайте аккумулятор, Глебски! Им нужно бежать!"'), nl,
    write('Вы отказываетесь. "Я полицейский. Они преступники."'), nl, nl,
    
    write('Симонэ уходит. Но через час дверь распахивается.'), nl,
    write('Хозяин Алек сзади хватает вас за локти. "Потерпите, Петер!"'), nl,
    write('Симонэ выхватывает люгер из вашего кармана и достает ключи от сейфа.'), nl, nl,
    
    write('Вы боретесь, но плечо, поврежденное Филином, не дает сопротивляться.'), nl,
    write('Симонэ открывает сейф и забирает чемодан. "Простите, инспектор!"'), nl, nl,
    write('Мозесы и однорукий заряжают Олафа, тот открывает глаза и поворачивает голову в анатомически верном направлении.'), nl,
    write('Голос Мозеса кричит: "Готовы? Вперед!"'), nl,
    write('Но они опоздали.'), nl,
    write('Спустя время после их ухода за окном слышится жуткий клекот и свист вертолетных лопастей.'), nl,
    write('И тут же - пулеметная очередь. Крики. Тишина.'), nl, nl,
    
    write('Хозяин отпускает вас. Вы выходите на крышу.'), nl,
    write('На снегу - четыре обезображенных тела. Вертолет удаляется вдаль.'), nl,
    write('Симонэ смотрит на вас с ненавистью: "Добился! Добился своего, дубина, убийца!"'), nl, nl,
    write('=== КОНЕЦ: ДОЛГ ==='), nl,
    ansi_format([bold,fg(yellow)], 'Вы следовали закону, но стали соучастником убийства. Межпланетный контакт не состоялся. Все делали правильно, чисты перед богом, законом и людьми, а совесть болит', []), nl.

финал(_) :-
    write('Неверный выбор или недостаточно информации для принятия решения.'), nl.

/*Синонимы команд*/
осмотреться :- look.
остановить :- halt.
идти(Место) :- goto(Место).
start :- старт.
investigate :- расследовать.